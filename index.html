<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link rel="manifest" href="/manifest.json" />	
  <title>Test page</title>
</head>
<body>
	<script>
		var p = new Promise(function(s, f){
			//s(123);
		});
		p.then(function(v){
			console.log(v);
			throw new Error('a');
			return v + 1;
		}).then(function(v){
			console.log(v);
			return v + 1;
		}).catch(function(e){
			console.log(e);
			return 2;
		}).then(function(v){
			console.log(v);
		});
		if(navigator.serviceWorker){
			navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
				serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly: true}).then(function(subscription) {
					console.log(subscription);
					//endpoint: "https://android.googleapis.com/gcm/send/cgJJ8JJ67hA:APA91bFF8KWCPUiou-YTRC-Q2GxsL-7ou4LKzFP3eYtp4M-w8X2s2pEiJdL3LCqtTw4AiCB9vwJ8sc9gDxmpQ5573N-ratrhFf76s2FX70hUcm4w-i2dwq3U9iPSIRk0Dbmhy64tVeZ5"
					//"https://android.googleapis.com/gcm/send";
			      
					
					// The subscription was successful  
					isPushEnabled = true;  
					//pushButton.textContent = 'Disable Push Messages';  
					//pushButton.disabled = false;
					//return sendSubscriptionToServer(subscription);
				}).catch(function(e){
					console.log(e);
				});
				console.log(serviceWorkerRegistration);
			});
			console.log(Notification.permission);
			navigator.serviceWorker.register("/test2.js").then(function(r){
				console.log(r.scope);
			}).catch(function(e){
				console.log(e);
			});
		}
		
		//var w = new Worker("test.js");
		// w.addEventListener("message", function(m){
		// 			console.log("worker said: " + m.data);
		// 		}, false);
		//w.postMessage("Hello worker!");
		
	</script>
</body>
</html>
