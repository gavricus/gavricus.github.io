<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link rel="manifest" href="/manifest.json" />	
  <title>Test page</title>
</head>
<body>
	<script>
		var p = new Promise(function(s, f){
			//s(123);
		});
		p.then(function(v){
			console.log(v);
			throw new Error('a');
			return v + 1;
		}).then(function(v){
			console.log(v);
			return v + 1;
		}).catch(function(e){
			console.log(e);
			return 2;
		}).then(function(v){
			console.log(v);
		});
		
		if(!navigator.serviceWorker){
			new Error('no service workers api');
		}
		if(!("showNotification" in ServiceWorkerRegistration.prototype)){
			new Error('no notification api');
		}
		if(Notification.permission == "denied"){
			new Error('notifications disabled');
		}else{
			console.log("permission is " + Notification.permission);
		}
		
		navigator.serviceWorker.register("/test2.js").then(function(r){
			console.log(r.scope);
			return r;
		}).catch(function(e){
			console.log(e);
		}).then(function(){
			console.log(124);
			navigator.serviceWorker.ready.then(function(reg) {
				reg.pushManager.getSubscription().then(function(subscription){
					console.log("subscription is " + subscription);
					if(subscription == null){
						reg.pushManager.subscribe().then(function(subscription) {  
							console.log("subscription is " + subscription);
						}).catch(function(e) {  
							console.log("permission is " + Notification.permission + "; error is " + e);
						});
					}
				}).catch(function(e){
					console.log("get subscription failed " + e);
				});
			});
		});		
		//var w = new Worker("test.js");
		// w.addEventListener("message", function(m){
		// 			console.log("worker said: " + m.data);
		// 		}, false);
		//w.postMessage("Hello worker!");
		
	</script>
</body>
</html>
